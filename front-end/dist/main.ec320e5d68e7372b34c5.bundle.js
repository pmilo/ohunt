!function(e){var t={};function a(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(r,o,function(t){return e[t]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t,a){},function(e,t,a){"use strict";a.r(t);a(0);const r={sresults:document.querySelector(".search-results"),navRows:document.querySelectorAll(".main-nav-row"),navRowResults:document.querySelector(".main-nav-row.results"),resultsNav:document.querySelector(".results .count"),savedJobsNav:document.querySelector(".saved-jobs .count"),appliedNav:document.querySelector(".applied .count"),archivedNav:document.querySelector(".archived .count"),jobRow:document.querySelectorAll(".sresults-row"),saveBtns:document.querySelectorAll(".watch-btn"),preview:document.querySelector(".preview"),previewHeader:document.querySelector(".preview-header"),previewHeaderBtns:document.querySelectorAll(".preview-header .i-wrapper"),previewSaveBtn:document.querySelector(".saved-preview-btn"),previewArchiveBtn:document.querySelector(".archive-preview-btn"),previewBody:document.querySelector(".preview-body"),previewTitle:document.querySelector(".job-title"),previewTxt:document.querySelector(".preview-txt"),posted:document.querySelector(".posted"),previewLogo:document.querySelector(".job-logo img"),previewLocation:document.querySelector("span.location"),previewCompany:document.querySelector("span.company"),viewBtnHref:document.querySelector(".view-btn-row a")},o=".sresults-row",s=".watch-btn",n=".archive-btn",c=".preview-header",i=(e,t,a)=>{const r=state.JobSearch.getJob(state.saved,e.id),o=state.JobSearch.getJob(state.archived,e.id);let s=`\n    \n    <div class="sresults-row" data-id=${e.id}>\n    <span class="c-logo logo">\n    <img src="${e.logo?e.logo:"imgs/ohunt-logo2.8b89ae493ac6525c8a06fd4fe23106c1.png"}" alt="logo">\n    </span>\n    <div class="pri-row">\n    <span class="role">${e.title}</span>\n    <span class="salary">${t}${e.salary_max}</span>                               \n    </div>\n    \n    <div class="company-location">${e.company.display_name?"<strong>"+e.company.display_name+"</strong>":"Company not specified"}</div>\n    <div class="location-row">${e.location.area[1]?e.location.area[1]:"Location not specified"}</div>\n    \n    <div class="stat-row">\n    <span class="btns-row">\n    <button class="watch-btn btn ${r?"selected":""}" title="Save Job"> ${r?"Saved":"Save Job"}</button>\n    <button class="note-btn btn" title="Add Note">+ Note</button>\n    <button class="archive-btn btn ${o?"selected":""}" title="Not Interested">&times</button>\n    </span>\n    \n    <span class="days">${u(e.created)}</span>\n    </div>  \n    </div>\n    `;return o&&"results"===a&&(s=""),s},l=e=>{let t=document.querySelector(`[data-id="${e}"]`);t.classList.contains("preview-header")||t.remove()},d=(e,t,a)=>{const{previewHeader:r,posted:o,previewTitle:s,previewLocation:n,previewCompany:c,previewLogo:i,previewTxt:l,viewBtnHref:d}=a,{company:v,location:p,logo:b,title:h,created:m,description:y,redirect_url:S}=e,w=state.JobSearch.getJob(state.saved,e.id),g=state.JobSearch.getJob(state.archived,e.id);w?(a.previewSaveBtn.textContent="Saved",a.previewSaveBtn.classList.add("selected")):(a.previewSaveBtn.textContent="Save Job",a.previewSaveBtn.classList.remove("selected")),g?a.previewArchiveBtn.classList.add("selected"):a.previewArchiveBtn.classList.remove("selected"),r.dataset.id=e.id,s.innerHTML=h,c.innerHTML=""+(v.display_name?v.display_name:"Company not specified"),i.src=""+(b||"imgs/ohunt-logo2.8b89ae493ac6525c8a06fd4fe23106c1.png"),n.innerHTML=" – "+(p.area[1]?p.area[1]:"Location not specified"),o.innerHTML=u(m),l.innerHTML=y,d.href=S},u=e=>{const[t,a,r]=e.split("-");let o=new Date(`${a} ${r}, ${t}`),s=new Date-o,n=Math.floor(s/864e5);return""+(n<1?"Today":n+" days ago")},v=e=>{var t;return e.title&&(e.title=e.title.replace(/<\/?[^>]+(>|$)/g,"")),e.location.area[1]||(e.location.area[1]=""),e.salary_max=(t=e.salary_max,100*Math.round(t/100)/1e3+"K").toString(),e.created=e.created.split("T")[0],e},p=()=>{state.JobSearch.resultsContainer.innerHTML=""},b=()=>{state.JobSearch.loadingElement.classList.add("hide")},h=(e,t)=>{const a=Object.keys(t).length;e.textContent=a<1?" ":Object.keys(t).length},m=e=>{[...document.querySelectorAll(o)].forEach(t=>{t.addEventListener("click",t=>{const a=state.JobSearch.getJob(state[e],t.currentTarget.dataset.id);d(a,0,r)})})},y=e=>{const t=[...document.querySelectorAll(s)];t.push(r.previewSaveBtn),t.forEach(e=>{e.addEventListener("click",t=>{let a,o;if(t.stopPropagation(),e.classList.contains("saved-preview-btn")){a=document.querySelector(c).dataset.id,o="preview"}else a=t.currentTarget.offsetParent.dataset.id,o="row";const s=state.JobSearch.getJob(state.results,a),n=state.JobSearch.getJob(state.saved,a),i=document.querySelector(".preview-header");n?n.id&&(state.JobSearch.deleteJob(n,a,"saved"),"saved"===r.sresults.board&&l(a),h(r.savedJobsNav,state.saved),t.currentTarget.textContent="Save Job",t.currentTarget.classList.remove("selected"),"preview"===o?(document.querySelector(`[data-id="${a}"] .watch-btn`).classList.remove("selected"),document.querySelector(`[data-id="${a}"] .watch-btn`).textContent="Save Job"):"row"===o&&a===i.dataset.id&&(r.previewSaveBtn.classList.remove("selected"),r.previewSaveBtn.textContent="Save Job")):(state.JobSearch.addJob(s,a,"saved"),h(r.savedJobsNav,state.saved),t.currentTarget.textContent="Saved",t.currentTarget.classList.add("selected"),"preview"===o?(document.querySelector(`[data-id="${a}"] .watch-btn`).classList.add("selected"),document.querySelector(`[data-id="${a}"] .watch-btn`).textContent="Saved"):"row"===o&&a===i.dataset.id&&(r.previewSaveBtn.classList.add("selected"),r.previewSaveBtn.textContent="Saved"))},!0)})},S=()=>{const e=[...document.querySelectorAll(n)];e.push(r.previewArchiveBtn),e.forEach(e=>{e.addEventListener("click",t=>{let a,o;t.stopPropagation(),o=e.classList.contains("archive-preview-btn"),o?a=document.querySelector(c).dataset.id:o||(a=t.currentTarget.offsetParent.dataset.id);const s=state.JobSearch.getJob(state.results,a),n=state.JobSearch.getJob(state.archived,a);if(n)n.id&&(state.JobSearch.deleteJob(n,a,"archived"),"saved"===r.sresults.board?t.currentTarget.classList.remove("selected"):l(a),h(r.archivedNav,state.archived));else{state.JobSearch.addJob(s,a,"archived"),l(a);const e=state.JobSearch.getJob(state.saved,a);e&&(state.JobSearch.deleteJob(e,a,"saved"),h(r.savedJobsNav,state.saved)),h(r.archivedNav,state.archived)}})})};const w={results:{},saved:{},archived:{}};window.state=w,window.addEventListener("load",()=>{w.JobSearch.readLocalStorage(w),h(r.savedJobsNav,w.saved),h(r.archivedNav,w.archived)}),w.JobSearch=new class{constructor(e,t,a,r){this.searchForm=document.querySelector(e),this.resultsContainer=document.querySelector(t),this.loadingElement=document.querySelector(a),this.findBtn=document.querySelector(r)}async getResults(e){const t=await fetch(e);return(await t.json()).results}async getCompanyData(e){const t=await fetch("https://autocomplete.clearbit.com/v1/companies/suggest?query=:"+e.company.display_name),a=await t.json();try{return a.length>=1&&(e.name=a[0].name,e.domain=a[0].domain,e.logo=a[0].logo),e}catch(e){alert(e)}}async addCompanyData(e){for(const t of e)if(t.company.display_name){const e=await state.JobSearch.getCompanyData(t);state.results["job-"+t.id]=e}}setCountryCode(){this.countryCode="gb",this.setCurrencySymbol()}getCurrencySymbol(e){return{gb:"£",us:"$",au:"$",ca:"$"}[e]}extractFormData(e){return Array.from(e.elements).reduce((e,{id:t,value:a})=>({...e,[t]:a}),{})}setCurrencySymbol(){this.currencySymbol=this.getCurrencySymbol(this.countryCode)}getJob(e,t){for(const[a,r]of Object.entries(e))if(r.id===t)return r}addJob(e,t,a){const r={...state[a]};r["job-"+t]=e,state[a]=r,this.updateLocalStorage(a)}deleteJob(e,t,a){const r={...state[a]};delete r["job-"+t],state[a]=r,this.updateLocalStorage(a)}updateLocalStorage(e){localStorage.setItem(e,JSON.stringify(state[e]))}readLocalStorage(e){Object.keys(e).map(e=>{const t=JSON.parse(localStorage.getItem(e));t&&(state[e]=t)})}}("#search-form",".search-results",".loading-element",".search-btn"),w.JobSearch.setCountryCode();const g=async()=>{w.results={},p(),state.JobSearch.loadingElement.classList.remove("hide");const{search:e,location:t}=w.JobSearch.extractFormData(w.JobSearch.searchForm),a=`http://localhost:5000/?search=${e}&location=${t}&country=${w.JobSearch.countryCode}`;let o;try{o=await w.JobSearch.getResults(a)}catch{alert("Search Error!"),b()}b(),await w.JobSearch.addCompanyData(o);let s=[];for(let[e,t]of Object.entries(w.results))e&&s.push(t);const n=s.map(e=>i(v(e),w.JobSearch.currencySymbol)).join("");w.JobSearch.resultsContainer.innerHTML=n,w.JobSearch.resultsContainer.style.overflow="scroll",f(),h(r.resultsNav,w.results)};g().then(()=>{r.previewHeader.classList.remove("no-display"),r.previewBody.classList.remove("no-display");const e=Object.keys(w.results)[0];r.navRowResults.classList.add("selected-nav"),d(w.results[e],0,r)}),w.JobSearch.findBtn.addEventListener("click",e=>{e.preventDefault(),g()});const f=()=>{m("results"),y(),S()};r.navRows.forEach(e=>{(e=>{e.addEventListener("click",e=>{document.querySelector(".selected-nav").classList.remove("selected-nav"),e.currentTarget.classList.add("selected-nav");let t=e.currentTarget.firstElementChild.textContent.split(" ")[0].toLowerCase();r.sresults.board=t,p();let a,o=[];for(let[e,a]of Object.entries(state[t]))e&&o.push(a);o.map(e=>{a+=i(e,state.JobSearch.currencySymbol,t)}).join(""),a||"results"!=t?a||(a=`<div class="sresults-desc"><i class="fas fa-exclamation"></i>&nbsp;&nbsp;You have no ${t} jobs.</div>`):a='<div class="sresults-desc"><i class="fas fa-info"></i>&nbsp;&nbsp;Use the Occuhunt search engine to find jobs.</div>',state.JobSearch.resultsContainer.innerHTML=a.replace(void 0,""),m(t),y(),S()})})(e)})}]);